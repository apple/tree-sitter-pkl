===
lambdas/typedLambdas.pkl
===

import "pkl:test"

res1 = ((x: Int) -> x + 1).apply(42)
res2 = test.catch(() -> ((x: Int) -> x + 1).apply("wrong type"))

res3 = ((x: Int(isPositive)) -> x + 1).apply(42)
res4 = test.catch(() -> ((x: Int(isPositive)) -> x + 1).apply(-1))

foo {
  n = 3
  bar {
    res5 = ((str: String(length > n)) -> str).apply("abcde")
    res6 = test.catch(() -> ((str: String(length > n)) -> str).apply("abc"))
  }
}

foo2 = (foo) {
  n = 4
}

hidden isNotEmpty = (coll: Collection) -> !coll.isEmpty

res7 = ((x: List<String>(isNotEmpty), y: Set<String>(isNotEmpty)) -> x.toSet() == y).apply(List("a", "b"), Set("b", "a"))

---

(module
  (importClause
    (stringConstant
      (slStringLiteralPart)))
  (classProperty
    (identifier)
    (qualifiedAccessExpr
      (parenthesizedExpr
        (functionLiteralExpr
          (parameterList
            (typedIdentifier
              (identifier)
              (typeAnnotation
                (declaredType
                  (qualifiedIdentifier
                    (identifier))))))
          (additiveExpr
            (unqualifiedAccessExpr
              (identifier))
            (intLiteralExpr))))
      (identifier)
      (argumentList
        (intLiteralExpr))))
  (classProperty
    (identifier)
    (qualifiedAccessExpr
      (unqualifiedAccessExpr
        (identifier))
      (identifier)
      (argumentList
        (functionLiteralExpr
          (parameterList)
          (qualifiedAccessExpr
            (parenthesizedExpr
              (functionLiteralExpr
                (parameterList
                  (typedIdentifier
                    (identifier)
                    (typeAnnotation
                      (declaredType
                        (qualifiedIdentifier
                          (identifier))))))
                (additiveExpr
                  (unqualifiedAccessExpr
                    (identifier))
                  (intLiteralExpr))))
            (identifier)
            (argumentList
              (slStringLiteralExpr
                (slStringLiteralPart))))))))
  (classProperty
    (identifier)
    (qualifiedAccessExpr
      (parenthesizedExpr
        (functionLiteralExpr
          (parameterList
            (typedIdentifier
              (identifier)
              (typeAnnotation
                (constrainedType
                  (declaredType
                    (qualifiedIdentifier
                      (identifier)))
                  (unqualifiedAccessExpr
                    (identifier))))))
          (additiveExpr
            (unqualifiedAccessExpr
              (identifier))
            (intLiteralExpr))))
      (identifier)
      (argumentList
        (intLiteralExpr))))
  (classProperty
    (identifier)
    (qualifiedAccessExpr
      (unqualifiedAccessExpr
        (identifier))
      (identifier)
      (argumentList
        (functionLiteralExpr
          (parameterList)
          (qualifiedAccessExpr
            (parenthesizedExpr
              (functionLiteralExpr
                (parameterList
                  (typedIdentifier
                    (identifier)
                    (typeAnnotation
                      (constrainedType
                        (declaredType
                          (qualifiedIdentifier
                            (identifier)))
                        (unqualifiedAccessExpr
                          (identifier))))))
                (additiveExpr
                  (unqualifiedAccessExpr
                    (identifier))
                  (intLiteralExpr))))
            (identifier)
            (argumentList
              (unaryMinusExpr
                (intLiteralExpr))))))))
  (classProperty
    (identifier)
    (objectBody
      (objectProperty
        (identifier)
        (intLiteralExpr))
      (objectProperty
        (identifier)
        (objectBody
          (objectProperty
            (identifier)
            (qualifiedAccessExpr
              (parenthesizedExpr
                (functionLiteralExpr
                  (parameterList
                    (typedIdentifier
                      (identifier)
                      (typeAnnotation
                        (constrainedType
                          (declaredType
                            (qualifiedIdentifier
                              (identifier)))
                          (comparisonExpr
                            (unqualifiedAccessExpr
                              (identifier))
                            (unqualifiedAccessExpr
                              (identifier)))))))
                  (unqualifiedAccessExpr
                    (identifier))))
              (identifier)
              (argumentList
                (slStringLiteralExpr
                  (slStringLiteralPart)))))
          (objectProperty
            (identifier)
            (qualifiedAccessExpr
              (unqualifiedAccessExpr
                (identifier))
              (identifier)
              (argumentList
                (functionLiteralExpr
                  (parameterList)
                  (qualifiedAccessExpr
                    (parenthesizedExpr
                      (functionLiteralExpr
                        (parameterList
                          (typedIdentifier
                            (identifier)
                            (typeAnnotation
                              (constrainedType
                                (declaredType
                                  (qualifiedIdentifier
                                    (identifier)))
                                (comparisonExpr
                                  (unqualifiedAccessExpr
                                    (identifier))
                                  (unqualifiedAccessExpr
                                    (identifier)))))))
                        (unqualifiedAccessExpr
                          (identifier))))
                    (identifier)
                    (argumentList
                      (slStringLiteralExpr
                        (slStringLiteralPart))))))))))))
  (classProperty
    (identifier)
    (amendExpr
      (parenthesizedExpr
        (unqualifiedAccessExpr
          (identifier)))
      (objectBody
        (objectProperty
          (identifier)
          (intLiteralExpr)))))
  (classProperty
    (modifier)
    (identifier)
    (functionLiteralExpr
      (parameterList
        (typedIdentifier
          (identifier)
          (typeAnnotation
            (declaredType
              (qualifiedIdentifier
                (identifier))))))
      (logicalNotExpr
        (qualifiedAccessExpr
          (unqualifiedAccessExpr
            (identifier))
          (identifier)))))
  (classProperty
    (identifier)
    (qualifiedAccessExpr
      (parenthesizedExpr
        (functionLiteralExpr
          (parameterList
            (typedIdentifier
              (identifier)
              (typeAnnotation
                (constrainedType
                  (declaredType
                    (qualifiedIdentifier
                      (identifier))
                    (typeArgumentList
                      (declaredType
                        (qualifiedIdentifier
                          (identifier)))))
                  (unqualifiedAccessExpr
                    (identifier)))))
            (typedIdentifier
              (identifier)
              (typeAnnotation
                (constrainedType
                  (declaredType
                    (qualifiedIdentifier
                      (identifier))
                    (typeArgumentList
                      (declaredType
                        (qualifiedIdentifier
                          (identifier)))))
                  (unqualifiedAccessExpr
                    (identifier))))))
          (equalityExpr
            (qualifiedAccessExpr
              (unqualifiedAccessExpr
                (identifier))
              (identifier)
              (argumentList))
            (unqualifiedAccessExpr
              (identifier)))))
      (identifier)
      (argumentList
        (unqualifiedAccessExpr
          (identifier)
          (argumentList
            (slStringLiteralExpr
              (slStringLiteralPart))
            (slStringLiteralExpr
              (slStringLiteralPart))))
        (unqualifiedAccessExpr
          (identifier)
          (argumentList
            (slStringLiteralExpr
              (slStringLiteralPart))
            (slStringLiteralExpr
              (slStringLiteralPart))))))))